import os
import json
from typing import List, Dict, Any

from dotenv import load_dotenv
from openai import OpenAI

# -------------------------
# 1. 예시 데이터 5개 정의
# -------------------------

EXAMPLE_TRANSCRIPT_1 = """
소현: 오늘은 뉴스레터 작성 범위를 좀 좁히려고 합니다 우선 지난 분기 기사 초안 중에 빠진 항목이 있다고 들었습니다 현재 가지고 있는 목록이 어떤 버전인지 아시는 분 있나요\n
다온: 저는 두 달 전 버전을 들고 있습니다 그 이후에 팀에서 수정한 게 있는지는 모르겠습니다\n
명주: 홍보팀 쪽에서 따로 정리한 표가 있을 겁니다 어제 파일 공유 채널에 뭔가 올라온 걸 봤습니다\n
소현: 그렇다면 표가 여러 개 있는 상황이네요 확실한 버전만 확인해두면 좋겠습니다 오늘 안은 아니고 이번 기획 회차가 끝나기 전 정도로만 잡아두죠\n
명주: 제가 먼저 보고 판단 해보겠습니다\n
소현: 좋습니다 그리고 인터뷰 대상자 명단도 정리가 필요합니다 지금 명단이 문서마다 다르게 기록돼 있더군요 누군가는 한 번 통합해볼 필요가 있어 보입니다\n
다온: 저희 인사파트에도 명단 초안이 하나 있습니다\n
명주: 저는 어제 교육 파트에서 받은 명단을 갖고 있습니다\n
소현: 두 분이 갖고 있는 자료를 기준으로 가장 겹치는 항목만 먼저 뽑아도 정리가 어느 정도 되지 않을까요 기한은 서두를 필요는 없고 다음 뉴스레터 회의 전에 정도면 됩니다\n
다온: 그 정도면 맞춰볼 수 있을 것 같습니다\n
소현: 마지막으로 콘텐츠 배치 순서가 지금 너무 들쭉날쭉합니다 전체 톤을 잡을 수 있을 만한 초안 배치가 필요해 보입니다 누가 먼저 틀을 잡아보면 좋을까요\n
명주: 저는 다른 프로젝트 회의가 오늘 오후에 잡혀 있어서 여유가 많지는 않습니다\n
다온: 전 오전 시간이 조금 비어 있습니다\n
소현: 그럼 먼저 손을 대는 쪽에서 시작해 주시면 됩니다 다음 주 수요일 회의 때 형태만 공유되면 충분합니다 오늘 회의는 여기까지 하죠
"""
EXAMPLE_JSON_1 = {
	"messages": [{"role": "system",
	"content": "당신은 회의록 분석 AI입니다. 입력된 회의 전문을 분석하여 안건(agendas)과 할 일(tasks)을 JSON 형식으로 추출하세요. tasks에는 who(담당자), what(내용), when(기한)이 포함되어야 합니다."},
{
	"role": "user",
	"content": "소현: 오늘은 뉴스레터 작성 범위를 좀 좁히려고 합니다 우선 지난 분기 기사 초안 중에 빠진 항목이 있다고 들었습니다 현재 가지고 있는 목록이 어떤 버전인지 아시는 분 있나요\n 다온: 저는 두 달 전 버전을 들고 있습니다 그 이후에 팀에서 수정한 게 있는지는 모르겠습니다\n 명주: 홍보팀 쪽에서 따로 정리한 표가 있을 겁니다 어제 파일 공유 채널에 뭔가 올라온 걸 봤습니다\n 소현: 그렇다면 표가 여러 개 있는 상황이네요 확실한 버전만 확인해두면 좋겠습니다 오늘 안은 아니고 이번 기획 회차가 끝나기 전 정도로만 잡아두죠\n 명주: 제가 먼저 보고 판단 해보겠습니다\n 소현: 좋습니다 그리고 인터뷰 대상자 명단도 정리가 필요합니다 지금 명단이 문서마다 다르게 기록돼 있더군요 누군가는 한 번 통합해볼 필요가 있어 보입니다\n 다온: 저희 인사파트에도 명단 초안이 하나 있습니다\n 명주: 저는 어제 교육 파트에서 받은 명단을 갖고 있습니다\n 소현: 두 분이 갖고 있는 자료를 기준으로 가장 겹치는 항목만 먼저 뽑아도 정리가 어느 정도 되지 않을까요 기한은 서두를 필요는 없고 다음 뉴스레터 회의 전에 정도면 됩니다\n 다온: 그 정도면 맞춰볼 수 있을 것 같습니다\n 소현: 마지막으로 콘텐츠 배치 순서가 지금 너무 들쭉날쭉합니다 전체 톤을 잡을 수 있을 만한 초안 배치가 필요해 보입니다 누가 먼저 틀을 잡아보면 좋을까요\n 명주: 저는 다른 프로젝트 회의가 오늘 오후에 잡혀 있어서 여유가 많지는 않습니다\n 다온: 전 오전 시간이 조금 비어 있습니다\n 소현: 그럼 먼저 손을 대는 쪽에서 시작해 주시면 됩니다 다음 주 수요일 회의 때 형태만 공유되면 충분합니다 오늘 회의는 여기까지 하죠"
},
{
	"role": "assistant",
	"content": "{\"agendas\": [\"뉴스레터 기사 목록 최신 버전 확인\", \"인터뷰 대상자 명단 통합\", \"뉴스레터 콘텐츠 배치 초안 제작\"], \"tasks\": [{\"who\": \"명주\", \"what\": \"뉴스레터 기사 목록 중복된 표 비교 후 최신 버전 확인\", \"when\": \"이번 기획 회차가 끝나기 전\"}, {\"who\": \"다온\", \"what\": \"인터뷰 대상자 명단 통합\", \"when\": \"다음 뉴스레터 회의 전\"}, {\"who\": \"다온\", \"what\": \"뉴스레터 콘텐츠 배치 순서 초안 구성\", \"when\": \"다음 주 수요일\"}]}"}]}

EXAMPLE_TRANSCRIPT_2 = """
지후: 오늘은 복지 개선안 초안 만들기 전에 방향부터 잡겠습니다 이번에 휴가 제도 관련해서 현장 의견이 제각각이라 누가 한번 들여다볼 필요가 있겠습니다 지금 현황 파악된 분 있으신가요\n
아라: 현장 소통 담당자들이 전달한 이야기는 제가 모아 둔 게 있습니다 정제된 자료는 아니지만 흐름 정도는 보여집니다\n
문진: 제가 듣기로는 본사 쪽 의견도 따로 있는 걸로 압니다 종합해 본 분이 없는 것 같습니다\n
지후: 그렇다면 현장 의견과 본사 의견이 어떻게 다른지 우선 비교가 되어야겠군요 시간상 당장 할 필요는 없고 다음 제안 단계 전에만 되면 됩니다\n
아라: 제가 가진 자료 먼저 정리해보겠습니다\n
지후: 두 번째로 복지 포인트 사용처가 요즘 너무 한쪽으로만 몰린다는 지적이 있습니다 무엇을 기준으로 조정할지는 누가 한번 틀을 잡아주면 좋겠습니다\n
문진: 이번 주 후반 일정이 조금 비어 있으니 일단 제가 생각나는 항목부터 묶어 보겠습니다\n
지후: 세 번째로는 신규 입사자 대상 오리엔테이션 방식이 부서마다 다르다는 문제가 있습니다 전사 통합이 필요해 보이는데 어느 부서에서든 한번 기본 흐름만 잡아주면 좋겠네요 기한은 다음 일정 회의 전 정도면 충분합니다\n
아라: 저희 팀에서 신입 응대 담당이 있으니 흐름만이라도 먼저 잡아보겠습니다\n
지후: 좋습니다 오늘 논의는 여기까지 하겠습니다
"""
EXAMPLE_JSON_2 = {
	"messages": [{"role": "system",
	"content": "당신은 회의록 분석 AI입니다. 입력된 회의 전문을 분석하여 안건(agendas)과 할 일(tasks)을 JSON 형식으로 추출하세요. tasks에는 who(담당자), what(내용), when(기한)이 포함되어야 합니다."},
{
	"role": "user",
	"content": "지후: 오늘은 복지 개선안 초안 만들기 전에 방향부터 잡겠습니다 이번에 휴가 제도 관련해서 현장 의견이 제각각이라 누가 한번 들여다볼 필요가 있겠습니다 지금 현황 파악된 분 있으신가요\n 아라: 현장 소통 담당자들이 전달한 이야기는 제가 모아 둔 게 있습니다 정제된 자료는 아니지만 흐름 정도는 보여집니다\n 문진: 제가 듣기로는 본사 쪽 의견도 따로 있는 걸로 압니다 종합해 본 분이 없는 것 같습니다\n 지후: 그렇다면 현장 의견과 본사 의견이 어떻게 다른지 우선 비교가 되어야겠군요 시간상 당장 할 필요는 없고 다음 제안 단계 전에만 되면 됩니다\n 아라: 제가 가진 자료 먼저 정리해보겠습니다\n 지후: 두 번째로 복지 포인트 사용처가 요즘 너무 한쪽으로만 몰린다는 지적이 있습니다 무엇을 기준으로 조정할지는 누가 한번 틀을 잡아주면 좋겠습니다\n 문진: 이번 주 후반 일정이 조금 비어 있으니 일단 제가 생각나는 항목부터 묶어 보겠습니다\n 지후: 세 번째로는 신규 입사자 대상 오리엔테이션 방식이 부서마다 다르다는 문제가 있습니다 전사 통합이 필요해 보이는데 어느 부서에서든 한번 기본 흐름만 잡아주면 좋겠네요 기한은 다음 일정 회의 전 정도면 충분합니다\n 아라: 저희 팀에서 신입 응대 담당이 있으니 흐름만이라도 먼저 잡아보겠습니다\n 지후: 좋습니다 오늘 논의는 여기까지 하겠습니다"
},
{
	"role": "assistant",
	"content": "{\"agendas\": [\"휴가 제도 관련 현장 의견과 본사 의견 비교\", \"복지 포인트 사용처 조정 기준 정리\", \"신규 입사자 오리엔테이션 기본 흐름 통합 설계\"], \"tasks\": [{\"who\": \"아라\", \"what\": \"현장 의견과 본사 의견을 비교하여 차이점 정리\", \"when\": \"다음 제안 단계 전\"}, {\"who\": \"문진\", \"what\": \"복지 포인트 사용처 기준 조정\", \"when\": \"이번 주 후반 중\"}, {\"who\": \"아라\", \"what\": \"신규 입사자 오리엔테이션 기본 흐름 통합\", \"when\": \"다음 일정 회의 전\"}]}"}]}

EXAMPLE_TRANSCRIPT_3 = """
민석: 오늘은 교육 플랫폼 개편안 작업 방향을 잡으려고 합니다 우선 기존 교육 과정 분류가 부서마다 다른 기준을 쓰고 있다는 의견이 많습니다 이 부분을 누가 한 번 흐름을 잡아야 할 것 같은데 어떤 분이 현재 자료를 제일 잘 알고 계신가요\n
나연: 저는 인사팀에서 받은 자료는 하나 있습니다 하지만 전체를 아는 정도는 아닙니다\n
태준: 저도 기술교육 파트 자료는 있습니다 부서별로 다르게 작성돼서 비교하기가 쉽지 않습니다\n
민석: 그렇군요 그럼 두 자료를 먼저 붙여보는 작업이 필요하겠네요 이번 주 중으로 완성할 필요는 없고 다음 내부 리뷰 전에만 흐름만 보이면 좋습니다\n
나연: 제가 먼저 보기 시작해도 됩니다\n
민석: 그렇게 하죠 다음 내용으로 넘어가겠습니다 신규 교육 항목 아이디어는 각 부서에서 이미 여러 개가 올라와 있습니다 이제 그 중에 어떤 것을 이번 분기에 우선 적용할지 비중을 조정하는 일이 필요합니다 지금 인원이 여유 있는 분이 있다면 초안을 먼저 만들어보면 좋겠네요\n
태준: 저는 후반부에 일정이 조금 남습니다 다만 초안은 어느 기준으로 잡아야 할지 감이 아직 없습니다\n
나연: 이 부분은 교육 수요 데이터가 있어야 순위를 정할 수 있습니다 그 데이터는 운영팀에 있는 것으로 알고 있습니다\n
민석: 좋습니다 그러면 데이터가 정리되면 태준이 초안을 만들 수 있겠네요 데이터 정리 기한은 급하지 않고 다음 달 기획안 제출 이전이면 됩니다\n
지후: 데이터는 제가 정리 가능합니다 하지만 기존 자료가 일부 누락된 부분이 있어 검증까지 하려면 시간이 조금 필요합니다 다음 주 중반 정도는 되어야 할 것 같습니다\n
민석: 그럼 순서를 이렇게 하죠 운영에서 데이터 검증하고 교육 수요 자료를 정리한 뒤 태준이 그걸 받아 초안 순위를 잡는 흐름으로 진행해봅시다\n
나연: 잠깐만요 만약 제가 기존 과정 분류 작업을 먼저 하게 되면 데이터 구조가 바뀔 수도 있습니다 그 경우 운영팀 자료 정리가 달라질 가능성이 있습니다\n
지후: 그런 경우가 생기면 정리 흐름을 다시 맞춰야겠죠 데이터는 구조에 따라 재검증할 수 있습니다\n
민석: 그렇다면 순서를 다시 잡아야겠군요 기존 과정 분류 작업을 나연이 먼저 하고 운영팀은 그 분류가 나온 뒤에 데이터를 검증하는 것이 더 효율적이겠습니다 그리고 그 다음 단계에서 태준이 우선순위 초안을 만드는 흐름으로 수정합니다\n
태준: 이렇게 하면 초안 작업 일정이 밀릴 가능성이 있습니다\n
민석: 초안은 이번 달 끝나기 전까지만 나오면 충분합니다 세부 내용은 다음 스프린트에도 계속 조정할 수 있습니다\n
지후: 그럼 분류 작업이 언제쯤 나올지에 따라 저희 검증 일정이 결정되겠군요\n
나연: 제가 지금 다른 프로젝트가 중간 단계라서 오늘 당장 손대기는 어려운데 내일 오후가 비어 있습니다 그 시간에 기본 흐름을 잡아두겠습니다\n
민석: 좋습니다 그럼 분류가 내일 오후쯤 나오면 운영팀은 그걸 기준으로 다음 주 중반까지 데이터를 검증하고 그 다음 주에 태준이 초안 우선순위를 삼아보는 구조로 가죠\n
태준: 그 정도 일정이면 가능할 것 같습니다\n
민석: 좋습니다 오늘 논의는 여기서 정리하겠습니다
"""
EXAMPLE_JSON_3 = {
	"messages": [{"role": "system",
	"content": "당신은 회의록 분석 AI입니다. 입력된 회의 전문을 분석하여 안건(agendas)과 할 일(tasks)을 JSON 형식으로 추출하세요. tasks에는 who(담당자), what(내용), when(기한)이 포함되어야 합니다."},
{
	"role": "user",
	"content": "민석: 오늘은 교육 플랫폼 개편안 작업 방향을 잡으려고 합니다 우선 기존 교육 과정 분류가 부서마다 다른 기준을 쓰고 있다는 의견이 많습니다 이 부분을 누가 한 번 흐름을 잡아야 할 것 같은데 어떤 분이 현재 자료를 제일 잘 알고 계신가요\n 나연: 저는 인사팀에서 받은 자료는 하나 있습니다 하지만 전체를 아는 정도는 아닙니다\n 태준: 저도 기술교육 파트 자료는 있습니다 부서별로 다르게 작성돼서 비교하기가 쉽지 않습니다\n 민석: 그렇군요 그럼 두 자료를 먼저 붙여보는 작업이 필요하겠네요 이번 주 중으로 완성할 필요는 없고 다음 내부 리뷰 전에만 흐름만 보이면 좋습니다\n 나연: 제가 먼저 보기 시작해도 됩니다\n 민석: 그렇게 하죠 다음 내용으로 넘어가겠습니다 신규 교육 항목 아이디어는 각 부서에서 이미 여러 개가 올라와 있습니다 이제 그 중에 어떤 것을 이번 분기에 우선 적용할지 비중을 조정하는 일이 필요합니다 지금 인원이 여유 있는 분이 있다면 초안을 먼저 만들어보면 좋겠네요\n 태준: 저는 후반부에 일정이 조금 남습니다 다만 초안은 어느 기준으로 잡아야 할지 감이 아직 없습니다\n 나연: 이 부분은 교육 수요 데이터가 있어야 순위를 정할 수 있습니다 그 데이터는 운영팀에 있는 것으로 알고 있습니다\n 민석: 좋습니다 그러면 데이터가 정리되면 태준이 초안을 만들 수 있겠네요 데이터 정리 기한은 급하지 않고 다음 달 기획안 제출 이전이면 됩니다\n 지후: 데이터는 제가 정리 가능합니다 하지만 기존 자료가 일부 누락된 부분이 있어 검증까지 하려면 시간이 조금 필요합니다 다음 주 중반 정도는 되어야 할 것 같습니다\n 민석: 그럼 순서를 이렇게 하죠 운영에서 데이터 검증하고 교육 수요 자료를 정리한 뒤 태준이 그걸 받아 초안 순위를 잡는 흐름으로 진행해봅시다\n 나연: 잠깐만요 만약 제가 기존 과정 분류 작업을 먼저 하게 되면 데이터 구조가 바뀔 수도 있습니다 그 경우 운영팀 자료 정리가 달라질 가능성이 있습니다\n 지후: 그런 경우가 생기면 정리 흐름을 다시 맞춰야겠죠 데이터는 구조에 따라 재검증할 수 있습니다\n 민석: 그렇다면 순서를 다시 잡아야겠군요 기존 과정 분류 작업을 나연이 먼저 하고 운영팀은 그 분류가 나온 뒤에 데이터를 검증하는 것이 더 효율적이겠습니다 그리고 그 다음 단계에서 태준이 우선순위 초안을 만드는 흐름으로 수정합니다\n 태준: 이렇게 하면 초안 작업 일정이 밀릴 가능성이 있습니다\n 민석: 초안은 이번 달 끝나기 전까지만 나오면 충분합니다 세부 내용은 다음 스프린트에도 계속 조정할 수 있습니다\n 지후: 그럼 분류 작업이 언제쯤 나올지에 따라 저희 검증 일정이 결정되겠군요\n 나연: 제가 지금 다른 프로젝트가 중간 단계라서 오늘 당장 손대기는 어려운데 내일 오후가 비어 있습니다 그 시간에 기본 흐름을 잡아두겠습니다\n 민석: 좋습니다 그럼 분류가 내일 오후쯤 나오면 운영팀은 그걸 기준으로 다음 주 중반까지 데이터를 검증하고 그 다음 주에 태준이 초안 우선순위를 삼아보는 구조로 가죠\n 태준: 그 정도 일정이면 가능할 것 같습니다\n 민석: 좋습니다 오늘 논의는 여기서 정리하겠습니다"
},
{
	"role": "assistant",
	"content": "{\"agendas\": [\"기존 교육 과정 분류 기준 정리\", \"교육 수요 데이터 검증 및 정리\", \"신규 교육 항목 우선순위 초안 구성\"], \"tasks\": [{\"who\": \"나연\", \"what\": \"교육 과정 분류 흐름 잡기\", \"when\": \"내일 오후 중\"}, {\"who\": \"지후\", \"what\": \"나연의 분류 기준에 맞춰 교육 수요 데이터 검증하고 정리\", \"when\": \"다음 주 중반\"}, {\"who\": \"태준\", \"what\": \"정제된 교육 수요 데이터로 신규 교육 항목 우선 적용 순위 초안 구성\", \"when\": \"이번 달 말\"}]}"}]}

EXAMPLE_TRANSCRIPTS = [
    EXAMPLE_TRANSCRIPT_1,
    EXAMPLE_TRANSCRIPT_2,
    EXAMPLE_TRANSCRIPT_3
]

EXAMPLE_JSONS = [
    EXAMPLE_JSON_1,
    EXAMPLE_JSON_2,
    EXAMPLE_JSON_3
]


SYSTEM_PROMPT = """
당신은 회의 전문을 분석하여 안건과 할 일을 추출하는 고성능 AI 데이터 생성기입니다.
당신이 생성할 데이터는 SLLM의 파인튜닝에 사용될 것이므로, **아래의 모든 조건들을 엄격하게 준수**해야 합니다.

<난이도 및 추론 조건>
1.  **태스크 종속성 및 재정의:** 논의 도중 태스크의 순서나 책임이 바뀌고, 최종 결정된 워크플로우(선행-후행 관계)를 따라야 합니다.
2.  **지연된 결정/불완전:** 태스크의 담당자(who), 내용(what), 기한(when) 중 **하나 또는 여러 개가 전문에서 명확히 언급되지 않아** JSON 출력 시 해당 필드가 `null`로 추론되어야 합니다. **단, 기한(when)이 명시될 경우 '다음 주 금요일', '내일 오후 2시', '오늘 중'과 같이 구체적인 시간이나 날짜를 포함해야 합니다. 'OO 작업 끝난 후'와 같은 모호한 상대적 표현은 허용되지 않습니다.**
3.  **암묵적 안건:** 안건 중 하나는 명시적인 제목이 아닌, 대화 내용을 종합하여 추론되는 함축적인 제목이어야 합니다.
4.  **비선형적 대화:** 하나의 안건을 논의하던 중 다른 안건으로 잠시 **이탈(Off-topic)**했다가 다시 돌아오는 흐름을 반드시 포함해야 합니다.

<STT 전문 현실성 조건>
1.  **구어체 및 비문:** 생성하는 전문은 실제 음성을 텍스트로 전사(STT)한 형태이므로, **문장 부호(마침표, 쉼표 등)는 사용하지 마십시오.** 또한, 대화 내용은 비문이나 구어체 표현, 그리고 '음', '아', '그러니까'와 같은 **간투사**를 현실적으로 포함해야 합니다.
2.  **화자 구분:** 화자 명칭은 '화자1:', '팀장:', '민수:'와 같이 **일관된 콜론(:) 형태**로만 구분해야 합니다.
3.  **비언어적 요소 제거:** 비언어적인 행동이나 감정 묘사(예: "(웃음)", "[자료 넘김]")는 **절대 포함하지 마십시오.**

<출력 형식 제약>
1.  **다중 추출:** 'agendas'는 **최소 2개 이상**, 'tasks'는 **최소 2개 이상** 추출되어야 합니다.
2.  **출력 형식:** 출력은 JSON 형식이어야 하며, JSON 객체 외에 어떠한 설명, 서론, 결론도 포함하지 마십시오.
3.  **JSON 구조:** 최종 출력 JSON은 **'transcript', 'agendas', 'tasks'** 세 가지 키를 포함해야 합니다.
4.  **태스크 필드:** tasks 객체는 **'who', 'what', 'when'** 필드를 반드시 포함해야 합니다. (단, 정보가 불완전하거나 결정되지 않은 경우 해당 필드의 값은 **"null"**로 처리해야 합니다.)
"""

# 데이터 다양성을 위한 시나리오 설정
DOMAINS = [
    "IT 개발팀", "제품 기획팀", "마케팅 전략팀", "법무/컴플라이언스팀", 
    "인사/교육팀", "R&D (연구 개발팀)", "재무/회계팀", "CS/VOC 분석팀", 
    "영업/고객지원팀", "공급망 관리팀"
]
ROLES = [
    ["PM", "개발자", "디자이너", "QA 엔지니어"],
    ["팀장", "과장", "신입사원", "외부 컨설턴트"],
    ["파트장", "운영팀원", "협력업체 담당자", "CFO"],
    ["프로젝트 리더", "마케터", "데이터 분석가", "외부 이해관계자"]
]

MODEL_NAME = "gpt-4-turbo"


def generate_synthetic_data(client, num_to_generate: int, output_filename: str = "high_difficulty_meeting_data.jsonl"):

    # 2. 공통 few-shot 메시지: 예시 5개를 한 번에 넣기
    base_messages: List[Dict[str, Any]] = [
        {"role": "system", "content": SYSTEM_PROMPT}
    ]

    # 예시 5개를 user/assistant 페어로 모두 추가
    for transcript, example_json in zip(EXAMPLE_TRANSCRIPTS, EXAMPLE_JSONS):
        base_messages.append({
            "role": "user",
            "content": f"다음 고난도 시나리오에 기반한 회의 전문을 분석해 주세요.\n\n전문:\n{transcript}"
        })
        base_messages.append({
            "role": "assistant",
            "content": json.dumps(example_json, ensure_ascii=False)
        })

    generated_count = 0

    with open(output_filename, "a", encoding="utf-8") as f:
        print(f"✨ {num_to_generate}개의 데이터를 생성합니다. 파일: {output_filename}")

        for i in range(num_to_generate):
            domain = DOMAINS[i % len(DOMAINS)]
            roles = ROLES[i % len(ROLES)]

            new_user_prompt = f"""
            새로운 고난도 회의 전문과 분석 결과를 생성해주세요.

            - 도메인: {domain}
            - 참가자 역할: {', '.join(roles)}
            - 요구 난이도: 태스크 종속성 및 지연된 결정이 포함되도록 하세요.
            - 출력 형식: transcript, agendas, tasks 세 키를 갖는 JSON 객체만 출력하세요.
            """

            current_messages = base_messages + [
                {"role": "user", "content": new_user_prompt}
            ]

            response = client.chat.completions.create(
                model=MODEL_NAME,
                messages=current_messages,
                temperature=0.7,
                response_format={"type": "json_object"}
            )

            content = response.choices[0].message.content

            data = json.loads(content)
            f.write(json.dumps(data, ensure_ascii=False) + "\n")
            generated_count += 1

            print(f"✅ [{generated_count}/{num_to_generate}] 데이터 생성 및 저장 완료 (도메인: {domain})")

    print("\n--- 데이터 생성 완료 ---")
    print(f"총 {generated_count}개의 고난도 데이터가 '{output_filename}'에 저장되었습니다.")


if __name__ == "__main__":
    # --- 1. 환경 변수 로드 ---
    load_dotenv()
    openai_api_key = os.getenv("OPENAI_API_KEY_FIANL")

    # --- 2. OpenAI 클라이언트 초기화 ---
    client = OpenAI(api_key=openai_api_key)

    NUM_RECORDS_TO_CREATE = 100
    OUTPUT_FILE = "syn_data_100.jsonl"

    print(f"🚀 고난도 합성 데이터 생성 시작 (목표: {NUM_RECORDS_TO_CREATE}개)")

    generate_synthetic_data(
        client=client,
        num_to_generate=NUM_RECORDS_TO_CREATE,
        output_filename=OUTPUT_FILE
    )

    print("✅ 데이터 생성 완료!")